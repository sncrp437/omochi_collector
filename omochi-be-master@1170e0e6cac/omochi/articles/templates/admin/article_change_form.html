{% extends "admin/change_form.html" %} 

{% block extrahead %} 
    {{ block.super }}
    <script>
        // Get FRONTEND_URL from Django context
        const FRONTEND_URL = "{{ FRONTEND_URL|default:'https://omochiapp.com' }}";

        document.addEventListener("change", function (e) {
            if (!e.target.matches('select[name$="venue"]')) return;

            const select = e.target;
            if (!select.value) return;

            const row = select.closest(".form-row, .form-group, tr");
            if (!row) return;

            const titleInput = row.querySelector('input[name$="title"]');
            const menuLinkInput = row.querySelector('input[name$="menu_link"]');

            // ---- Autofill title ----
            if (titleInput) {
                const option = select.options[select.selectedIndex];
                if (option && option.text && option.text !== "---------") {
                    titleInput.value = option.text;
                }
            }

            // ---- Autofill menu_link by venue.id ----
            if (menuLinkInput) {
                const venueId = select.value;
                const newMenuLink = `${FRONTEND_URL}/store/${venueId}`;

                // Auto fill menu link whenever venue is selected
                menuLinkInput.value = newMenuLink;
            }
        });
    </script>
{% endblock %}
